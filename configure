#!/usr/bin/perl

use strict;
use warnings;

my $prefix = '/usr/local';
my $version = '0.1.0';

for (@ARGV)
{
	if (/^--prefix=(.*)/)
	{
		$prefix = $1;
	}
	else
	{
		print "Usage: $0 [OPTION ...]\n\t--prefix=<prefix>    \tspecify install location (default /usr/local)\n";
		exit;
	}
}

sub generate
{
	my ($in, $out, @args) = @_;

	open STDOUT, '>', $out;
	system 'sed', @args, $in;
	close STDOUT;
	chmod 0444, $out;
}

generate 'src/ffind.c', 'src/ffind.c.in', ('-e', "s/\@{VERSION}/$version/");

$prefix .= '/';
$prefix =~ s|/|\\/|g;

generate 'Makefile', 'Makefile.in', ('-e', "s/\@{PREFIX}/$prefix/");

#my ($sec, $min, $hour, $mday, $month, $year, $wday, $yday, $dst) = localtime();
#my @months = qw|January February March April May June July August September October November December|;
#my $date = "$mday $months[$month] $year";
my $date = '17 March 2015';

open STDOUT, '>', 'ffind.1';
system 'sed', '-e', "s/\@{DATE}/$date/", '-e', "s/\@{VERSION}/$version/", 'ffind.1.in';
close STDOUT;
